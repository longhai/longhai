<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game List</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #search-container {
            margin-bottom: 20px;
        }
        .letter {
            display: inline-block;
            margin-right: 10px;
            cursor: pointer;
        }
        #game-list {
            list-style-type: none;
            padding: 0;
        }
        .game-item {
            margin-bottom: 10px;
            cursor: pointer;
        }
        #pagination {
            margin-top: 20px;
        }
        .game-item img {
            width: 150px;
            height: auto;
        }
    </style>
</head>
<body>
    <h1>Game List</h1>
    <div id="source-menu">
        <select id="source-select">
            <option value="nes" data-display-name="Nintendo - Nintendo Entertainment System">Nintendo Entertainment System</option>
            <option value="snes" data-display-name="Nintendo - Super Nintendo Entertainment System">Super Nintendo Entertainment System</option>
            <option value="gba" data-display-name="Nintendo - Game Boy Advance">Game Boy Advance</option>
        </select>
    </div>
    <div id="search-container">
        <span class="letter" data-letter="all">All</span>
    <span class="letter" data-letter="0-9">0-9</span>
    <span class="letter" data-letter="A">A</span>
    <span class="letter" data-letter="B">B</span>
    <span class="letter" data-letter="C">C</span>
    <span class="letter" data-letter="D">D</span>
    <span class="letter" data-letter="E">E</span>
    <span class="letter" data-letter="F">F</span>
    <span class="letter" data-letter="G">G</span>
    <span class="letter" data-letter="H">H</span>
    <span class="letter" data-letter="I">I</span>
    <span class="letter" data-letter="J">J</span>
    <span class="letter" data-letter="K">K</span>
    <span class="letter" data-letter="L">L</span>
    <span class="letter" data-letter="M">M</span>
    <span class="letter" data-letter="N">N</span>
    <span class="letter" data-letter="O">O</span>
    <span class="letter" data-letter="P">P</span>
    <span class="letter" data-letter="Q">Q</span>
    <span class="letter" data-letter="R">R</span>
    <span class="letter" data-letter="S">S</span>
    <span class="letter" data-letter="T">T</span>
    <span class="letter" data-letter="U">U</span>
    <span class="letter" data-letter="V">V</span>
    <span class="letter" data-letter="W">W</span>
    <span class="letter" data-letter="X">X</span>
    <span class="letter" data-letter="Y">Y</span>
    <span class="letter" data-letter="Z">Z</span>
    </div>
    <ul id="game-list"></ul>
    <div id="pagination">
        <button id="prev-btn" disabled>Prev</button>
        <button id="next-btn">Next</button>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const itemsPerPage = 10;
            const defaultImageUrl = 'https://longhai.github.io/image.png'; // Replace with the default image URL
            let currentPage = 1;
            let games = [];
            let filteredGames = [];
            let selectedSource = 'nes';

            const sourceSelect = document.getElementById('source-select');
            sourceSelect.addEventListener('change', function() {
                selectedSource = this.value;
                loadXML(selectedSource);
            });

            function loadXML(source) {
                let url;
                const selectedOption = sourceSelect.options[sourceSelect.selectedIndex];
                const displayName = selectedOption.getAttribute('data-display-name');

                if (source === 'snes') {
                    url = 'https://longhai.github.io/dat/Nintendo - Super Nintendo Entertainment System.dat';
                } else if (source === 'gba') {
                    url = 'https://longhai.github.io/dat/Nintendo - Game Boy Advance.dat';
                } else {
                    url = 'https://longhai.github.io/dat/Nintendo - Nintendo Entertainment System (Headered).dat';
                }

                fetch(url)
                    .then(response => response.text())
                    .then(data => {
                        const parser = new DOMParser();
                        const xmlDoc = parser.parseFromString(data, "text/xml");
                        games = Array.from(xmlDoc.getElementsByTagName('game')).map(game => ({
                            name: game.getAttribute('name'),
                            description: game.getElementsByTagName('description')[0]?.textContent || game.getAttribute('name'),
                            imageUrl: `https://thumbnails.libretro.com/${encodeURIComponent(displayName)}/Named_Titles/${encodeURIComponent(game.getAttribute('name'))}.png`
                        }));
                        filteredGames = games;
                        displayGames(filteredGames, currentPage);
                    });
            }

            loadXML(selectedSource);

            const letters = document.querySelectorAll('.letter');
            letters.forEach(letter => {
                letter.addEventListener('click', () => {
                    const selectedLetter = letter.getAttribute('data-letter');
                    filterGames(selectedLetter);
                });
            });

            document.getElementById('next-btn').addEventListener('click', () => {
                currentPage++;
                displayGames(filteredGames, currentPage);
            });

            document.getElementById('prev-btn').addEventListener('click', () => {
                currentPage--;
                displayGames(filteredGames, currentPage);
            });

            function displayGames(games, page) {
                const gameList = document.getElementById('game-list');
                const startIndex = (page - 1) * itemsPerPage;
                const endIndex = page * itemsPerPage;
                const totalPages = Math.ceil(games.length / itemsPerPage);
                const prevBtn = document.getElementById('prev-btn');
                const nextBtn = document.getElementById('next-btn');

                gameList.innerHTML = '';
                for (let i = startIndex; i < endIndex && i < games.length; i++) {
                    const li = document.createElement('li');
                    li.className = 'game-item';
                    
                    const img = document.createElement('img');
                    img.src = games[i].imageUrl;
                    img.alt = games[i].description;
                    img.onerror = function() {
                        this.onerror = null;
                        this.src = defaultImageUrl;
                    };

                    li.appendChild(img);
                    li.appendChild(document.createTextNode(games[i].description));
                    li.addEventListener('click', () => {
                        playGame(games[i].name, selectedSource);
                    });
                    gameList.appendChild(li);
                }

                prevBtn.disabled = page === 1;
                nextBtn.disabled = page === totalPages;
            }

            function filterGames(letter) {
                if (letter === 'all') {
                    filteredGames = games;
                } else if (letter === '0-9') {
                    filteredGames = games.filter(game => /^[0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~`]/.test(game.description));
                } else {
                    filteredGames = games.filter(game => game.description.toUpperCase().startsWith(letter));
                }
                currentPage = 1;
                displayGames(filteredGames, currentPage);
            }

            function playGame(gameName, source) {
                const encodedGameName = encodeURIComponent(gameName);
                let gameUrl = '';

                if (source === 'snes') {
                    gameUrl = `https://archive.org/download/ni-roms/roms/Nintendo - Super Nintendo Entertainment System.zip/${encodedGameName}.zip`;
                } else if (source === 'gba') {
                    gameUrl = `https://archive.org/download/ni-roms/roms/Nintendo - Game Boy Advance.zip/${encodedGameName}.zip`;
                } else if (source === 'nes') {
                    gameUrl = `https://archive.org/download/ni-roms/roms/Nintendo - Nintendo Entertainment System (Headered).zip/${encodedGameName}.zip`;
                }

                const playUrl = `https://longhai.github.io/load.html?core=${source}&url=${gameUrl}`;
                window.open(playUrl, '_blank', 'width=800,height=600,resizable=yes,scrollbars=yes');
            }
        });
    </script>
</body>
</html>
